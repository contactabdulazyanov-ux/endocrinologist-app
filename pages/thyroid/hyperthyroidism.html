<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Гипертиреоз - Диагностика и лечение - Эндокринолог PRO</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #7e22ce;
            --accent: #06b6d4;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --light: #f8fafc;
            --dark: #1e293b;
            --text: #374151;
            --text-light: #6b7280;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
            color: var(--text);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header h1 {
            font-size: 2.8em;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.3em;
            opacity: 0.95;
            font-weight: 300;
        }

        .main-menu {
            display: flex;
            justify-content: center;
            background: var(--dark);
            padding: 20px;
            gap: 8px;
            flex-wrap: wrap;
        }

        .main-menu a {
            padding: 12px 24px;
            text-decoration: none;
            color: white;
            font-weight: 600;
            border-radius: 50px;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .main-menu a:hover, .main-menu a.active {
            background: var(--primary);
            transform: translateY(-2px);
        }

        .content {
            padding: 40px;
        }

        .page-title {
            font-size: 2.2em;
            color: var(--dark);
            margin-bottom: 10px;
            font-weight: 700;
        }

        .page-subtitle {
            font-size: 1.2em;
            color: var(--text-light);
            margin-bottom: 30px;
        }

        .disease-section {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            padding: 30px;
            border-radius: 16px;
            margin: 30px 0;
            border: 1px solid #fecaca;
        }

        .section-title {
            font-size: 1.8em;
            color: var(--dark);
            margin-bottom: 20px;
            font-weight: 700;
        }

        .section-subtitle {
            font-size: 1.1em;
            color: var(--text-light);
            margin-bottom: 25px;
        }

        .classification-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .classification-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            border-left: 4px solid var(--danger);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .classification-card h4 {
            color: var(--danger);
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .diagnosis-treatment-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin: 25px 0;
        }

        @media (max-width: 768px) {
            .diagnosis-treatment-grid {
                grid-template-columns: 1fr;
            }
        }

        .diagnosis-card, .treatment-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .diagnosis-card {
            border-left: 4px solid var(--primary);
        }

        .treatment-card {
            border-left: 4px solid var(--success);
        }

        .card-title {
            font-size: 1.3em;
            color: var(--dark);
            margin-bottom: 15px;
            font-weight: 700;
        }

        .special-cases {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            padding: 25px;
            border-radius: 12px;
            margin: 25px 0;
            border: 1px solid #bae6fd;
        }

        .case-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .case-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }

        .case-card h4 {
            color: var(--dark);
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .emergency-box {
            background: #fef2f2;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 4px solid var(--danger);
        }

        .calculators-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .calculator-card {
            background: white;
            border-radius: 16px;
            padding: 30px;
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .calculator-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        .calculator-card h3 {
            color: var(--dark);
            margin-bottom: 20px;
            font-size: 1.3em;
            font-weight: 700;
        }

        .form-group {
            background: #f8fafc;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid #e2e8f0;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 10px;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            background: white;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .range-info {
            font-size: 0.9em;
            color: var(--text-light);
            margin-top: 8px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 14px 28px;
            background: linear-gradient(135deg, var(--danger), #dc2626);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(220, 38, 38, 0.3);
        }

        .result-box {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin-top: 20px;
            border: 1px solid #fecaca;
            display: none;
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .info-card {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            padding: 25px;
            border-radius: 16px;
            border: 1px solid #bae6fd;
        }

        .info-card h3 {
            color: var(--dark);
            margin-bottom: 15px;
            font-size: 1.3em;
            font-weight: 700;
        }

        .info-card ul {
            list-style: none;
            padding-left: 0;
        }

        .info-card li {
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
            position: relative;
            padding-left: 25px;
        }

        .info-card li:before {
            content: '•';
            color: var(--primary);
            font-weight: bold;
            position: absolute;
            left: 0;
        }

        .pregnancy-section {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 1px solid #bae6fd;
        }

        .warning-box {
            background: #fef3c7;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 4px solid var(--warning);
        }

        @media (max-width: 768px) {
            .content {
                padding: 30px 20px;
            }
            .calculators-grid {
                grid-template-columns: 1fr;
            }
            .info-grid {
                grid-template-columns: 1fr;
            }
            .main-menu {
                flex-direction: column;
            }
            .main-menu a {
                width: 100%;
                text-align: center;
            }
            .header h1 {
                font-size: 2.2em;
            }
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .checkbox-label input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary), #6b21a8);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #d97706);
        }

        .required-field::after {
            content: " *";
            color: var(--danger);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📈 ГИПЕРТИРЕОЗ</h1>
            <p>Диагностика и лечение повышенной функции щитовидной железы</p>
        </div>

        <nav class="main-menu">
            <a href="../../index.html">🏠 Главная</a>
            <a href="index.html">🦋 Щитовидная железа</a>
            <a href="hypothyroidism.html">📉 Гипотиреоз</a>
            <a href="hyperthyroidism.html" class="active">📈 Гипертиреоз</a>
        </nav>

        <div class="content">
            <h1 class="page-title">Гипертиреоз (Тиреотоксикоз)</h1>
            <p class="page-subtitle">Повышенная функция щитовидной железы - диагностика и современное лечение</p>

            <!-- ОСНОВНОЙ КАЛЬКУЛЯТОР: Определение формы гипертиреоза -->
            <section class="disease-section">
                <h2 class="section-title">🔍 Определение формы гипертиреоза</h2>
                <p class="section-subtitle">Дифференциальная диагностика на основе ТТГ, св.Т4, св.Т3, АТ-рТТГ и клинических данных</p>

                <div class="calculator-card">
                    <h3>🎯 Дифференциальная диагностика тиреотоксикоза</h3>
                    
                    <div class="form-group">
                        <label for="formTsh" class="required-field">ТТГ (мМЕ/л)</label>
                        <input type="number" step="0.001" id="formTsh" placeholder="Например: 0.02">
                        <div class="range-info">Норма: 0.4 - 4.0 мМЕ/л</div>
                    </div>

                    <div class="form-group">
                        <label for="formT4" class="required-field">св. Т4 (пмоль/л)</label>
                        <input type="number" step="0.1" id="formT4" placeholder="Например: 35.0">
                        <div class="range-info">Норма: 11.0 - 22.0 пмоль/л</div>
                    </div>

                    <div class="form-group">
                        <label for="formT3">св. Т3 (пмоль/л) - необязательно</label>
                        <input type="number" step="0.1" id="formT3" placeholder="Например: 12.5">
                        <div class="range-info">Норма: 3.5 - 6.5 пмоль/л</div>
                    </div>

                    <div class="form-group">
                        <label for="formRtg">АТ-рТТГ (МЕ/л) - необязательно</label>
                        <input type="number" step="0.01" id="formRtg" placeholder="Например: 8.5">
                        <div class="range-info">Норма: < 1.75 МЕ/л</div>
                    </div>

                    <div class="form-group">
                        <label>Клинические симптомы:</label>
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" name="formSymptoms" value="tachycardia"> Тахикардия
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="formSymptoms" value="weight_loss"> Похудение
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="formSymptoms" value="tremor"> Тремор
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="formSymptoms" value="nervousness"> Нервозность
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="formSymptoms" value="heat"> Непереносимость жары
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="formSymptoms" value="sweating"> Потливость
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="formSymptoms" value="pain"> Боли в шее
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="formSymptoms" value="fever"> Лихорадка
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="formSymptoms" value="eye"> Симптомы со стороны глаз
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="formSymptoms" value="weakness"> Слабость
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="formUltrasound">Данные УЗИ щитовидной железы:</label>
                        <select id="formUltrasound">
                            <option value="unknown">Неизвестно/Не выполнялось</option>
                            <option value="diffuse">Диффузные изменения</option>
                            <option value="nodular">Узловые образования</option>
                            <option value="multinodular">Многоузловой зоб</option>
                            <option value="normal">Нормальная картина</option>
                            <option value="hypoechoic">Гипоэхогенность, "пылающая" железа</option>
                        </select>
                    </div>

                    <div class="btn-group">
                        <button class="btn" onclick="calculateHyperthyroidismForm()">🔍 Определить форму</button>
                        <button class="btn btn-warning" onclick="clearFormForm()">🔄 Очистить</button>
                        <button class="btn btn-secondary" onclick="fillSampleGraves()">🦋 Болезнь Грейвса</button>
                        <button class="btn btn-secondary" onclick="fillSampleToxicNodule()">🔘 Токсический узел</button>
                        <button class="btn btn-secondary" onclick="fillSampleThyroiditis()">🔥 Тиреоидит</button>
                    </div>

                    <div id="formResult" class="result-box"></div>
                </div>
            </section>

            <!-- СЕКЦИЯ БОЛЕЗНИ ГРЕЙВСА -->
            <section class="disease-section">
                <h2 class="section-title">🦋 Болезнь Грейвса (Диффузный токсический зоб)</h2>
                <p class="section-subtitle">Аутоиммунное заболевание с выработкой антител к рецептору ТТГ</p>

                <!-- Классификация тяжести -->
                <h3>🎯 Классификация степени тяжести тиреотоксикоза</h3>
                <div class="classification-grid">
                    <div class="classification-card">
                        <h4>Субклинический тиреотоксикоз</h4>
                        <ul>
                            <li><strong>Клиника:</strong> Стертая, неявная</li>
                            <li><strong>Гормоны:</strong> Сниженный ТТГ при нормальных свТ4 и свТ3</li>
                        </ul>
                    </div>
                    <div class="classification-card">
                        <h4>Манифестный тиреотоксикоз</h4>
                        <ul>
                            <li><strong>Клиника:</strong> Развернутая, характерная</li>
                            <li><strong>Гормоны:</strong> Сниженный ТТГ при повышенных свТ4 и/или свТ3</li>
                        </ul>
                    </div>
                    <div class="classification-card">
                        <h4>Осложненный тиреотоксикоз</h4>
                        <ul>
                            <li><strong>Критерий:</strong> Наличие тяжелых осложнений</li>
                            <li><strong>Примеры:</strong> Фибрилляция предсердий, сердечная недостаточность, тромбоэмболии, токсический гепатит, психоз, кахексия</li>
                        </ul>
                    </div>
                </div>

                <!-- КАЛЬКУЛЯТОРЫ БОЛЕЗНИ ГРЕЙВСА -->
                <h3 style="margin: 35px 0 20px 0; color: var(--dark);">🧮 Калькуляторы болезни Грейвса</h3>
                <p class="section-subtitle">Автоматизированные расчеты для диагностики и лечения диффузного токсического зоба</p>

                <div class="calculators-grid">
                    <!-- Калькулятор 1: Стартовая доза тиреостатиков -->
                    <div class="calculator-card">
                        <h3>💊 Расчет стартовой дозы тиреостатиков</h3>
                        <div class="form-group">
                            <label for="gravesWeight">Вес пациента (кг)</label>
                            <input type="number" id="gravesWeight" placeholder="Например: 70" value="70">
                        </div>
                        <div class="form-group">
                            <label for="gravesT4">св. Т4 (пмоль/л)</label>
                            <input type="number" step="0.1" id="gravesT4" placeholder="Например: 35.0" value="35.0">
                            <div class="range-info">Норма: 11.0 - 22.0 пмоль/л</div>
                        </div>
                        <div class="form-group">
                            <label for="gravesSeverity">Тяжесть тиреотоксикоза</label>
                            <select id="gravesSeverity">
                                <option value="mild">Легкий (ТТГ 0.1-0.4, свТ4 до 30)</option>
                                <option value="moderate" selected>Умеренный (ТТГ < 0.1, свТ4 30-40)</option>
                                <option value="severe">Тяжелый (ТТГ < 0.01, свТ4 > 40 + осложнения)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="gravesHeartDisease">Сердечно-сосудистые осложнения</label>
                            <select id="gravesHeartDisease">
                                <option value="no">Нет</option>
                                <option value="yes">Да (тахикардия, аритмия)</option>
                            </select>
                        </div>
                        <button class="btn" onclick="calculateGravesDose()">🧮 Рассчитать дозу</button>
                        <div id="gravesDoseResult" class="result-box"></div>
                    </div>

                    <!-- Калькулятор 2: Контроль терапии и коррекция дозы -->
                    <div class="calculator-card">
                        <h3>📊 Контроль терапии и коррекция дозы</h3>
                        <div class="form-group">
                            <label for="currentDose">Текущая доза тиамазола (мг/сут)</label>
                            <input type="number" id="currentDose" placeholder="Например: 30" value="30">
                        </div>
                        <div class="form-group">
                            <label for="controlTsh">ТТГ через 4-6 недель (мМЕ/л)</label>
                            <input type="number" step="0.01" id="controlTsh" placeholder="Например: 0.1" value="0.1">
                            <div class="range-info">Норма: 0.4 - 4.0 мМЕ/л</div>
                        </div>
                        <div class="form-group">
                            <label for="controlT4">св. Т4 через 4-6 недель (пмоль/л)</label>
                            <input type="number" step="0.1" id="controlT4" placeholder="Например: 25.0" value="25.0">
                        </div>
                        <button class="btn" onclick="calculateDoseAdjustment()">📈 Оценить эффективность</button>
                        <div id="adjustmentResult" class="result-box"></div>
                    </div>

                    <!-- Калькулятор 3: Оценка риска рецидива -->
                    <div class="calculator-card">
                        <h3>📈 Оценка риска рецидива</h3>
                        <div class="form-group">
                            <label for="relapseAntibody">АТ-рТТГ перед отменой (МЕ/л)</label>
                            <input type="number" step="0.01" id="relapseAntibody" placeholder="Например: 2.5" value="2.5">
                            <div class="range-info">Норма: < 1.75 МЕ/л</div>
                        </div>
                        <div class="form-group">
                            <label for="relapseTsh">ТТГ перед отменой (мМЕ/л)</label>
                            <input type="number" step="0.01" id="relapseTsh" placeholder="Например: 1.2" value="1.2">
                        </div>
                        <div class="form-group">
                            <label for="relapseDuration">Длительность терапии (мес)</label>
                            <input type="number" id="relapseDuration" placeholder="Например: 18" value="18">
                        </div>
                        <button class="btn" onclick="calculateRelapseRisk()">🎯 Оценить риск рецидива</button>
                        <div id="relapseResult" class="result-box"></div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <script>
        // ТЕСТОВАЯ ФУНКЦИЯ ДЛЯ ПРОВЕРКИ РАБОТОСПОСОБНОСТИ
        console.log('=== ТЕСТ СТРАНИЦЫ ГИПЕРТИРЕОЗА ===');

        // Проверяем загрузку DOM
        document.addEventListener('DOMContentLoaded', function() {
            console.log('✅ DOM загружен');
            
            // Проверяем основные элементы
            const testElements = [
                'formTsh', 'formT4', 'formResult', 
                'gravesWeight', 'gravesDoseResult',
                'currentDose', 'adjustmentResult'
            ];
            
            testElements.forEach(id => {
                const element = document.getElementById(id);
                console.log(`✅ Элемент ${id}:`, element ? 'НАЙДЕН' : 'НЕ НАЙДЕН');
            });
            
            // Проверяем функции
            if (typeof calculateHyperthyroidismForm === 'function') {
                console.log('✅ Функция calculateHyperthyroidismForm доступна');
            } else {
                console.log('❌ Функция calculateHyperthyroidismForm НЕ доступна');
            }
            
            if (typeof calculateGravesDose === 'function') {
                console.log('✅ Функция calculateGravesDose доступна');
            } else {
                console.log('❌ Функция calculateGravesDose НЕ доступна');
            }
            
            // Тест простой функции
            function simpleTest() {
                console.log('✅ Простой тест выполнен');
                return true;
            }
            simpleTest();
        });

        // 1. ОСНОВНОЙ КАЛЬКУЛЯТОР: Определение формы гипертиреоза
        function calculateHyperthyroidismForm() {
            console.log('🚀 Функция calculateHyperthyroidismForm вызвана');
            
            const tsh = parseFloat(document.getElementById('formTsh').value);
            const t4 = parseFloat(document.getElementById('formT4').value);
            const t3 = parseFloat(document.getElementById('formT3').value) || null;
            const rtg = parseFloat(document.getElementById('formRtg').value) || null;
            const symptoms = Array.from(document.querySelectorAll('input[name="formSymptoms"]:checked')).map(el => el.value);
            const ultrasound = document.getElementById('formUltrasound').value;

            console.log('📊 Введенные данные:', { tsh, t4, t3, rtg, symptoms, ultrasound });

            // Проверка обязательных полей
            if (!tsh || !t4) {
                alert('Пожалуйста, заполните обязательные поля: ТТГ и св.Т4');
                return;
            }

            let diagnosis = '';
            let probability = '';
            let diagnosticCriteria = [];
            let treatmentApproach = [];
            let additionalTests = [];
            let color = '';

            // Основная диагностическая логика
            if (tsh < 0.1 && t4 > 22.0) {
                // Проверка на болезнь Грейвса
                if ((rtg && rtg > 1.75) || symptoms.includes('eye') || ultrasound === 'diffuse' || ultrasound === 'hypoechoic') {
                    diagnosis = '🦋 Болезнь Грейвса (Диффузный токсический зоб)';
                    probability = 'Высокая вероятность (85-90%)';
                    color = '#dc2626';
                    
                    diagnosticCriteria = [
                        'Типичная гормональная картина: ТТГ ↓, св.Т4 ↑',
                        t3 ? 'св.Т3 ↑ (Т3-тиреотоксикоз)' : 'св.Т3 может быть в норме или повышен',
                        rtg ? `Повышены антитела к рецептору ТТГ (${rtg} МЕ/л)` : 'Антитела к рТТГ могут быть повышены',
                        'Клинические симптомы тиреотоксикоза',
                        symptoms.includes('eye') ? 'Эндокринная офтальмопатия' : 'Возможна эндокринная офтальмопатия',
                        'УЗИ: диффузные изменения, гипоэхогенность'
                    ];

                    treatmentApproach = [
                        'Консервативное: Тиамазол 10-40 мг/сут',
                        'Радиойодтерапия при рецидивах или противопоказаниях к тиреостатикам',
                        'Хирургическое лечение при больших размерах зоба или компрессии'
                    ];

                } 
                // Проверка на токсический узловой зоб
                else if (ultrasound === 'nodular' || ultrasound === 'multinodular') {
                    diagnosis = '🔘 Токсический узловой/многоузловой зоб';
                    probability = 'Высокая вероятность (80-85%)';
                    color = '#7e22ce';
                    
                    diagnosticCriteria = [
                        'Типичная гормональная картина: ТТГ ↓, св.Т4 ↑',
                        t3 ? `св.Т3 ${t3 > 6.5 ? '↑' : 'в норме'}` : 'св.Т3 может быть в норме',
                        rtg ? `Антитела к рТТГ ${rtg <= 1.75 ? 'в норме' : 'умеренно повышены'}` : 'Антитела к рТТГ обычно в норме',
                        'Узловые образования по УЗИ',
                        'Повышенное поглощение при сцинтиграфии в узлах'
                    ];

                    treatmentApproach = [
                        'Радиойодтерапия - метод выбора',
                        'Хирургическое лечение при компрессии или больших размерах',
                        'Тиреостатики для подготовки к радикальному лечению'
                    ];

                } 
                // Проверка на тиреоидит
                else if (symptoms.includes('pain') || symptoms.includes('fever') || ultrasound === 'hypoechoic') {
                    diagnosis = '🔥 Подострый тиреоидит (de Quervain)';
                    probability = 'Средняя вероятность (60-70%)';
                    color = '#ea580c';
                    
                    diagnosticCriteria = [
                        'Типичная гормональная картина: ТТГ ↓, св.Т4 ↑',
                        t3 ? `св.Т3 ${t3 > 6.5 ? '↑' : 'в норме'}` : 'св.Т3 может быть в норме',
                        'Боли в области шеи, лихорадка',
                        'Сниженное поглощение при сцинтиграфии',
                        'Повышение СОЭ, С-реактивного белка',
                        'Часто - предшествующая вирусная инфекция'
                    ];

                    treatmentApproach = [
                        'Противовоспалительная терапия (НПВС)',
                        'Кортикостероиды при тяжелом течении',
                        'Бета-блокаторы для контроля симптомов',
                        'Тиреостатики НЕ эффективны!'
                    ];

                } 
                // Другие формы
                else {
                    diagnosis = '🎭 Другие формы тиреотоксикоза';
                    probability = 'Требуется дифференциальная диагностика';
                    color = '#6b7280';
                    
                    diagnosticCriteria = [
                        'Исключить медикаментозный тиреотоксикоз (амиодарон, интерферон)',
                        'Исключить йод-индуцированный тиреотоксикоз',
                        'Исключить ТТГ-продуцирующую аденому гипофиза',
                        'Исключить struma ovarii',
                        'Исключить метастазы рака щитовидной железы'
                    ];

                    additionalTests = [
                        'Сцинтиграфия щитовидной железы',
                        'МРТ гипофиза при нормальном/повышенном ТТГ',
                        'Исследование хорионического гонадотропина',
                        'Анализ принимаемых препаратов'
                    ];
                }
            } 
            // Субклинический гипертиреоз
            else if (tsh < 0.4 && t4 <= 22.0) {
                diagnosis = '📊 Субклинический гипертиреоз';
                probability = 'Требуется наблюдение и уточнение причины';
                color = '#d97706';
                
                diagnosticCriteria = [
                    'Сниженный ТТГ при нормальном св.Т4',
                    t3 ? `св.Т3 ${t3 > 6.5 ? '↑' : 'в норме'}` : 'св.Т3 обычно в норме',
                    'Может быть бессимптомным',
                    'Повышен риск фибрилляции предсердий у пожилых',
                    'Требуется динамическое наблюдение'
                ];

                treatmentApproach = [
                    'Наблюдение при ТТГ 0.1-0.4 мМЕ/л у молодых пациентов',
                    'Лечение при ТТГ < 0.1 мМЕ/л у пожилых',
                    'Лечение при симптомах или сопутствующих заболеваниях',
                    'Определение причины субклинического гипертиреоза'
                ];
            } 
            // Норма или другие состояния
            else {
                if (tsh >= 0.4 && tsh <= 4.0 && t4 >= 11.0 && t4 <= 22.0) {
                    diagnosis = '🟢 Эутиреоз (норма)';
                    probability = 'Нормальная функция щитовидной железы';
                    color = '#059669';
                } else if (tsh > 4.0 && t4 < 11.0) {
                    diagnosis = '📉 Гипотиреоз';
                    probability = 'Сниженная функция щитовидной железы';
                    color = '#2563eb';
                } else {
                    diagnosis = '❓ Несоответствующая картина';
                    probability = 'Требуется дополнительное обследование';
                    color = '#6b7280';
                }
                
                diagnosticCriteria = [
                    'Необходимы все основные показатели: ТТГ, св.Т4',
                    'Рекомендуется исследование АТ-рТТГ при подозрении на аутоиммунный процесс',
                    'УЗИ щитовидной железы для оценки структуры',
                    'Повторное исследование через 4-6 недель при сомнительных результатах'
                ];
            }

            // Формирование результата
            let resultHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 1.5em; font-weight: 800; color: ${color};">${diagnosis}</div>
                    <div style="font-size: 1.1em; margin-top: 10px; color: ${color};">${probability}</div>
                </div>
                
                <div style="background: #f8fafc; padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <h4>📋 Диагностические критерии:</h4>
                    <ul>
                        ${diagnosticCriteria.map(criterion => `<li>${criterion}</li>`).join('')}
                    </ul>
                </div>
            `;

            if (treatmentApproach.length > 0) {
                resultHTML += `
                    <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h4>💊 Подходы к лечению:</h4>
                        <ul>
                            ${treatmentApproach.map(approach => `<li>${approach}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }

            if (additionalTests.length > 0) {
                resultHTML += `
                    <div style="background: #fef3c7; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h4>🔍 Дополнительные исследования:</h4>
                        <ul>
                            ${additionalTests.map(test => `<li>${test}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }

            // Блок с интерпретацией показателей
            resultHTML += `
                <div style="background: #e0f2fe; padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <h4>📊 Интерпретация показателей:</h4>
                    <div style="display: grid; gap: 8px;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>ТТГ:</span>
                            <strong>${tsh} мМЕ/л ${getTSHStatus(tsh)}</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>св.Т4:</span>
                            <strong>${t4} пмоль/л ${getT4Status(t4)}</strong>
                        </div>
                        ${t3 ? `
                        <div style="display: flex; justify-content: space-between;">
                            <span>св.Т3:</span>
                            <strong>${t3} пмоль/л ${getT3Status(t3)}</strong>
                        </div>
                        ` : ''}
                        ${rtg ? `
                        <div style="display: flex; justify-content: space-between;">
                            <span>АТ-рТТГ:</span>
                            <strong>${rtg} МЕ/л ${getRTGStatus(rtg)}</strong>
                        </div>
                        ` : ''}
                    </div>
                </div>
                
                <div style="background: #fef3c7; padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <h4>💡 Рекомендации:</h4>
                    <p>Для уточнения диагноза рекомендуется:</p>
                    <ul>
                        <li>Повторить исследование гормонов через 4-6 недель</li>
                        <li>Выполнить УЗИ щитовидной железы</li>
                        <li>Определить антитела к рТТГ при подозрении на болезнь Грейвса</li>
                        <li>Провести сцинтиграфию при узловых образованиях</li>
                    </ul>
                </div>
            `;

            document.getElementById('formResult').innerHTML = resultHTML;
            document.getElementById('formResult').style.display = 'block';
            
            console.log('✅ Результат отображен');
        }

        // Вспомогательные функции для статусов
        function getTSHStatus(tsh) {
            if (tsh < 0.1) return '🔴 Резко снижен';
            if (tsh < 0.4) return '🟡 Снижен';
            if (tsh <= 4.0) return '🟢 Норма';
            return '🔴 Повышен';
        }

        function getT4Status(t4) {
            if (t4 < 11.0) return '🔴 Снижен';
            if (t4 <= 22.0) return '🟢 Норма';
            return '🔴 Повышен';
        }

        function getT3Status(t3) {
            if (t3 < 3.5) return '🔴 Снижен';
            if (t3 <= 6.5) return '🟢 Норма';
            return '🔴 Повышен';
        }

        function getRTGStatus(rtg) {
            if (rtg <= 1.75) return '🟢 Норма';
            if (rtg <= 5.0) return '🟡 Умеренно повышены';
            return '🔴 Значительно повышены';
        }

        function clearFormForm() {
            document.getElementById('formTsh').value = '';
            document.getElementById('formT4').value = '';
            document.getElementById('formT3').value = '';
            document.getElementById('formRtg').value = '';
            document.querySelectorAll('input[name="formSymptoms"]').forEach(checkbox => checkbox.checked = false);
            document.getElementById('formUltrasound').value = 'unknown';
            document.getElementById('formResult').style.display = 'none';
        }

        // Автозаполнение для демонстрации
        function fillSampleGraves() {
            document.getElementById('formTsh').value = '0.02';
            document.getElementById('formT4').value = '38.5';
            document.getElementById('formT3').value = '12.8';
            document.getElementById('formRtg').value = '15.2';
            document.querySelector('input[value="tachycardia"]').checked = true;
            document.querySelector('input[value="weight_loss"]').checked = true;
            document.querySelector('input[value="tremor"]').checked = true;
            document.querySelector('input[value="nervousness"]').checked = true;
            document.querySelector('input[value="eye"]').checked = true;
            document.getElementById('formUltrasound').value = 'diffuse';
        }

        function fillSampleToxicNodule() {
            document.getElementById('formTsh').value = '0.05';
            document.getElementById('formT4').value = '28.0';
            document.getElementById('formT3').value = '8.5';
            document.getElementById('formRtg').value = '1.2';
            document.querySelector('input[value="tachycardia"]').checked = true;
            document.querySelector('input[value="weight_loss"]').checked = true;
            document.getElementById('formUltrasound').value = 'nodular';
        }

        function fillSampleThyroiditis() {
            document.getElementById('formTsh').value = '0.08';
            document.getElementById('formT4').value = '32.0';
            document.getElementById('formT3').value = '9.2';
            document.getElementById('formRtg').value = '0.8';
            document.querySelector('input[value="pain"]').checked = true;
            document.querySelector('input[value="fever"]').checked = true;
            document.querySelector('input[value="weakness"]').checked = true;
            document.getElementById('formUltrasound').value = 'hypoechoic';
        }

        // 2. Калькулятор стартовой дозы тиреостатиков
        function calculateGravesDose() {
            console.log('🚀 Функция calculateGravesDose вызвана');
            
            const weight = parseFloat(document.getElementById('gravesWeight').value);
            const t4 = parseFloat(document.getElementById('gravesT4').value);
            const severity = document.getElementById('gravesSeverity').value;
            const heartDisease = document.getElementById('gravesHeartDisease').value === 'yes';

            if (!weight || !t4) {
                alert('Пожалуйста, заполните вес пациента и уровень св. Т4');
                return;
            }

            let initialDose, drugChoice, recommendations = [];
            let duration = "12-18 месяцев";

            switch(severity) {
                case 'mild':
                    initialDose = "10-20 мг/сут";
                    drugChoice = "Тиамазол (Тирозol)";
                    recommendations.push("Контроль ТТГ, св.Т4 каждые 4-6 недель");
                    break;
                case 'moderate':
                    initialDose = "20-30 мг/сут";
                    drugChoice = "Тиамазол (Тирозol)";
                    recommendations.push("Разделить дозу на 2 приема");
                    recommendations.push("Контроль каждые 2-4 недели в начале лечения");
                    break;
                case 'severe':
                    initialDose = "30-40 мг/сут";
                    drugChoice = "Тиамазол (Тирозol)";
                    recommendations.push("Обязательное разделение дозы на 2-3 приема");
                    recommendations.push("Частый контроль - каждые 2 недели");
                    break;
            }

            if (heartDisease) {
                recommendations.push("Назначение бета-блокаторов под контролем ЭКГ");
            }

            recommendations.push("Контроль общего анализа крови каждые 2 недели в первые 2 месяца");
            recommendations.push("Обучение пациента симптомам агранулоцитоза");

            let resultHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 1.5em; font-weight: 800; color: var(--danger);">
                        ${drugChoice}
                    </div>
                </div>
                
                <div style="background: #fef2f2; padding: 20px; border-radius: 12px; margin: 15px 0;">
                    <h4>💊 Режим дозирования:</h4>
                    <div style="display: grid; gap: 12px; margin-top: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span><strong>Стартовая доза:</strong></span>
                            <span style="font-size: 1.2em; color: var(--danger);">${initialDose}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span><strong>Продолжительность:</strong></span>
                            <span style="font-size: 1.1em; color: var(--warning);">${duration}</span>
                        </div>
                    </div>
                </div>
                
                <div style="background: #f0fdf4; padding: 15px; border-radius: 8px;">
                    <h4>💡 Рекомендации:</h4>
                    <ul>
                        ${recommendations.map(rec => `<li>${rec}</li>`).join('')}
                    </ul>
                </div>
            `;

            document.getElementById('gravesDoseResult').innerHTML = resultHTML;
            document.getElementById('gravesDoseResult').style.display = 'block';
            
            console.log('✅ Результат отображен');
        }

        // 3. Калькулятор контроля терапии и коррекция дозы
        function calculateDoseAdjustment() {
            console.log('🚀 Функция calculateDoseAdjustment вызвана');
            
            const currentDose = parseFloat(document.getElementById('currentDose').value);
            const tsh = parseFloat(document.getElementById('controlTsh').value);
            const t4 = parseFloat(document.getElementById('controlT4').value);

            if (!currentDose || !tsh || !t4) {
                alert('Заполните текущую дозу, ТТГ и св. Т4');
                return;
            }

            let adjustment = "";
            let newDose = currentDose;
            let recommendations = [];
            let assessment = "";
            let color = "";

            if (tsh < 0.1 && t4 > 22.0) {
                assessment = "🔴 НЕДОСТАТОЧНЫЙ КОНТРОЛЬ";
                color = "#dc2626";
                adjustment = `Увеличить дозу на 10-20 мг/сут`;
                newDose = currentDose + 20;
                recommendations = [
                    `Новая доза: ${newDose} мг/сут`,
                    "Контроль ТТГ и св.Т4 через 2-3 недели",
                    "Оценить приверженность лечению"
                ];
            } else if (tsh > 2.0 && t4 < 11.0) {
                assessment = "🔴 ПЕРЕДОЗИРОВКА";
                color = "#dc2626";
                adjustment = `Уменьшить дозу на 10-20 мг/сут`;
                newDose = Math.max(5, currentDose - 20);
                recommendations = [
                    `Новая доза: ${newDose} мг/сут`,
                    "Контроль ТТГ и св.Т4 через 4 недели",
                    "Оценить симптомы гипотиреоза"
                ];
            } else if (tsh >= 0.5 && tsh <= 2.0 && t4 >= 11.0 && t4 <= 22.0) {
                assessment = "🟢 ОПТИМАЛЬНЫЙ КОНТРОЛЬ";
                color = "#059669";
                adjustment = "Доза адекватна";
                recommendations = [
                    "Продолжать текущую дозу",
                    "Контроль ТТГ и св.Т4 через 4-6 недель",
                    "Рассмотреть постепенное снижение дозы"
                ];
            } else {
                assessment = "🟡 СУБОПТИМАЛЬНЫЙ КОНТРОЛЬ";
                color = "#d97706";
                adjustment = "Рассмотреть коррекцию дозы на 5-10 мг/сут";
                recommendations = [
                    "Повторить исследование через 2-3 недели",
                    "Оценить клиническую симптоматику"
                ];
            }

            let resultHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 1.5em; font-weight: 800; color: ${color};">${assessment}</div>
                    <div style="font-size: 1.2em; margin-top: 10px;">${adjustment}</div>
                </div>
                
                <div style="background: #f8fafc; padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <h4>📊 Текущие показатели:</h4>
                    <div style="display: grid; gap: 8px;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>Текущая доза:</span>
                            <strong>${currentDose} мг/сут</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>ТТГ:</span>
                            <strong>${tsh} мМЕ/л</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>св. Т4:</span>
                            <strong>${t4} пмоль/л</strong>
                        </div>
                    </div>
                </div>
                
                <div style="background: #f0fdf4; padding: 15px; border-radius: 8px;">
                    <h4>💡 Рекомендации:</h4>
                    <ul>
                        ${recommendations.map(rec => `<li>${rec}</li>`).join('')}
                    </ul>
                </div>
            `;

            document.getElementById('adjustmentResult').innerHTML = resultHTML;
            document.getElementById('adjustmentResult').style.display = 'block';
            
            console.log('✅ Результат отображен');
        }

        // 4. Калькулятор оценки риска рецидива
        function calculateRelapseRisk() {
            console.log('🚀 Функция calculateRelapseRisk вызвана');
            
            const antibody = parseFloat(document.getElementById('relapseAntibody').value);
            const tsh = parseFloat(document.getElementById('relapseTsh').value);
            const duration = parseInt(document.getElementById('relapseDuration').value);

            if (!antibody || !tsh || !duration) {
                alert('Пожалуйста, заполните обязательные поля');
                return;
            }

            let relapseRisk = "";
            let riskPercentage = "";
            let recommendations = [];
            let color = "";

            let riskScore = 0;

            if (antibody > 5) riskScore += 3;
            else if (antibody > 2) riskScore += 2;
            else if (antibody > 1.75) riskScore += 1;

            if (tsh < 0.5) riskScore += 2;
            else if (tsh < 1.0) riskScore += 1;

            if (duration < 12) riskScore += 2;
            else if (duration < 18) riskScore += 1;

            if (riskScore >= 5) {
                relapseRisk = "🔴 ВЫСОКИЙ РИСК РЕЦИДИВА";
                riskPercentage = "70-80%";
                color = "#dc2626";
                recommendations = [
                    "Рекомендуется продление терапии на 12-18 месяцев",
                    "Рассмотреть радикальное лечение (РЙТ или тиреоидэктомия)",
                    "Контроль АТ-рТТГ каждые 3 месяца"
                ];
            } else if (riskScore >= 3) {
                relapseRisk = "🟡 СРЕДНИЙ РИСК РЕЦИДИВА";
                riskPercentage = "40-50%";
                color = "#d97706";
                recommendations = [
                    "Продолжение терапии на 6-12 месяцев",
                    "Контроль АТ-рТТГ каждые 6 месяцев",
                    "Оценка через 6 месяцев для коррекции тактики"
                ];
            } else {
                relapseRisk = "🟢 НИЗКИЙ РИСК РЕЦИДИВА";
                riskPercentage = "20-30%";
                color = "#059669";
                recommendations = [
                    "Возможна отмена терапии",
                    "Контроль АТ-рТТГ через 3 месяца после отмену",
                    "Регулярное наблюдение 1 раз в 6-12 месяцев"
                ];
            }

            let resultHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 1.5em; font-weight: 800; color: ${color};">${relapseRisk}</div>
                    <div style="font-size: 1.2em; margin-top: 10px;">Вероятность рецидива: ${riskPercentage}</div>
                </div>
                
                <div style="background: #f8fafc; padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <h4>📊 Факторы риска:</h4>
                    <div style="display: grid; gap: 8px;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>АТ-рТТГ:</span>
                            <strong>${antibody} МЕ/л ${antibody > 1.75 ? '🚩' : '✅'}</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>ТТГ:</span>
                            <strong>${tsh} мМЕ/л ${tsh < 0.5 ? '🚩' : '✅'}</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>Длительность терапии:</span>
                            <strong>${duration} мес ${duration < 18 ? '🚩' : '✅'}</strong>
                        </div>
                    </div>
                </div>
                
                <div style="background: #f0fdf4; padding: 15px; border-radius: 8px;">
                    <h4>💡 Рекомендации:</h4>
                    <ul>
                        ${recommendations.map(rec => `<li>${rec}</li>`).join('')}
                    </ul>
                </div>
            `;

            document.getElementById('relapseResult').innerHTML = resultHTML;
            document.getElementById('relapseResult').style.display = 'block';
            
            console.log('✅ Результат отображен');
        }
    </script>
</body>
</html>
